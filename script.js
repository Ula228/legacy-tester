let menu = [];
let current = {};
let score = 0;
let questionCount = 0;
const totalQuestions = 10;

async function loadMenu() {
  const res = await fetch('legacy_menu.json');
  menu = await res.json();
  nextQuestion();
}

function nextQuestion() {
  if (questionCount >= totalQuestions) {
    const result = document.getElementById("question");
    const optionsEl = document.getElementById("options");
    result.textContent = `–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω. ${score}/${totalQuestions} –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö.`;
    optionsEl.innerHTML = score >= 7
      ? "üé© –£–≤–∞–∂–µ–Ω–∏–µ. –¢—ã –∑–Ω–∞–µ—à—å –º–µ–Ω—é, –∫–∞–∫ –î–æ–Ω –∑–Ω–∞–µ—Ç —Å–µ–º—å—é."
      : "‚ùå –¢—ã –ø–æ–¥–≤—ë–ª —Å–µ–º—å—é. –ü–æ–≤—Ç–æ—Ä–∏ –µ—â—ë —Ä–∞–∑.";
    document.querySelector("button").disabled = true;
    return;
  }

  const questionEl = document.getElementById('question');
  const optionsEl = document.getElementById('options');
  const scoreEl = document.getElementById('score');
  optionsEl.innerHTML = '';
  scoreEl.textContent = `–í–æ–ø—Ä–æ—Å ${questionCount + 1} –∏–∑ ${totalQuestions}`;

  current = menu[Math.floor(Math.random() * menu.length)];
  questionEl.textContent = `–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –±–ª—é–¥–æ: "${current.name}"?`;

  let prices = [current.price];
  while (prices.length < 4) {
    let fake = menu[Math.floor(Math.random() * menu.length)].price;
    if (!prices.includes(fake)) prices.push(fake);
  }

  prices = prices.sort(() => Math.random() - 0.5);

  prices.forEach(price => {
    const btn = document.createElement('div');
    btn.className = 'option';
    btn.textContent = `${price} ‚Ç∏`;
    btn.onclick = () => checkAnswer(price);
    optionsEl.appendChild(btn);
  });
}

function checkAnswer(price) {
  const options = document.querySelectorAll('.option');
  options.forEach(option => {
    const val = parseInt(option.textContent);
    if (val === current.price) {
      option.style.background = '#1d6b1d';
    } else if (val === price) {
      option.style.background = '#6b1d1d';
    }
    option.onclick = null;
  });

  if (price === current.price) score++;
  questionCount++;
}
window.onload = loadMenu;
